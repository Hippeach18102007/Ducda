<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Th√™m v√† Qu·∫£n l√Ω L·ªõp h·ªçc</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="container mt-4">
    <div class="row">
        <div class="col-md-5">
            <h1 class="mb-4 text-info">üè´ Th√™m L·ªõp h·ªçc M·ªõi</h1>

            <div th:if="${message}" class="alert alert-success" role="alert">
                <span th:text="${message}">ƒê√£ x·∫øp l·ªõp th√†nh c√¥ng!</span>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                <span th:text="${errorMessage}">L·ªói x·∫øp l·ªõp!</span>
            </div>

            <form th:action="@{/classes/add}" th:object="${classManager}" method="post">
                <div class="mb-3">
                    <label for="className" class="form-label">T√™n L·ªõp:</label>
                    <input type="text" class="form-control" id="className" th:field="*{className}" required>
                </div>

                <div class="mb-3">
                    <label for="khoaHoc" class="form-label">Khoa / Chuy√™n ng√†nh (c·ªßa L·ªõp):</label>
                    <select class="form-select" id="khoaHoc" th:field="*{khoaHoc}" required>
                        <option value="">-- Ch·ªçn Khoa/Chuy√™n ng√†nh --</option>
                        <option value="C√¥ng ngh·ªá th√¥ng tin">C√¥ng ngh·ªá th√¥ng tin</option>
                        <option value="Khoa h·ªçc m√°y t√≠nh">Khoa h·ªçc m√°y t√≠nh</option>
                        <option option value="Kinh t·∫ø">Kinh t·∫ø</option>
                        <option value="Y h·ªçc">Y h·ªçc</option>
                        <option value="Khoa kh√°c">Khoa kh√°c</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="trangThai" class="form-label">Tr·∫°ng th√°i:</label>
                    <select class="form-select" id="trangThai" th:field="*{trangThai}" required>
                        <option value="">-- Ch·ªçn Tr·∫°ng th√°i --</option>
                        <option value="ƒêang ho·∫°t ƒë·ªông">ƒêang ho·∫°t ƒë·ªông</option>
                        <option value="S·∫Øp khai gi·∫£ng">S·∫Øp khai gi·∫£ng</option>
                        <option value="ƒê√£ k·∫øt th√∫c">ƒê√£ k·∫øt th√∫c</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="soLuongSinhVien" class="form-label">Ch·ªâ ti√™u (T·ªëi ƒëa):</label>
                    <input type="number" step="1" min="1" class="form-control" id="soLuongSinhVien" th:field="*{soLuongSinhVien}" required>
                </div>
                <button type="submit" class="btn btn-info">L∆∞u L·ªõp h·ªçc</button>
                <a th:href="@{/students/list}" class="btn btn-secondary">Quay v·ªÅ danh s√°ch SV</a>
            </form>
        </div>

        <div class="col-md-7">
            <h2 class="mb-4 text-secondary">üìñ Danh s√°ch L·ªõp h·ªçc hi·ªán c√≥</h2>
            <div th:if="${classes.isEmpty()}">
                <p class="text-muted">Ch∆∞a c√≥ l·ªõp h·ªçc n√†o.</p>
            </div>
            <table class="table table-striped table-bordered" th:if="${!classes.isEmpty()}">
                <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>T√™n L·ªõp</th>
                    <th>Khoa</th>
                    <th>Tr·∫°ng Th√°i</th>
                    <th>Sƒ© s·ªë</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="lop : ${classes}">
                    <td th:text="${lop.idClass}"></td>
                    <td th:text="${lop.className}"></td>
                    <td th:text="${lop.khoaHoc}"></td>
                    <td>
                        <span th:if="${lop.trangThai == 'ƒêang ho·∫°t ƒë·ªông'}" class="badge bg-success" th:text="${lop.trangThai}"></span>
                        <span th:if="${lop.trangThai == 'S·∫Øp khai gi·∫£ng'}" class="badge bg-warning" th:text="${lop.trangThai}"></span>
                        <span th:if="${lop.trangThai == 'ƒê√£ k·∫øt th√∫c'}" class="badge bg-danger" th:text="${lop.trangThai}"></span>
                    </td>
                    <td th:text="${lop.soLuongSinhVienHienTai} + ' / ' + ${lop.soLuongSinhVien}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <hr class="my-5"/>

    <h2 class="mt-4 text-danger">‚ö†Ô∏è Sinh vi√™n ch∆∞a x·∫øp l·ªõp (Ph√¢n lo·∫°i theo Chuy√™n ng√†nh)</h2>

    <div th:if="${groupedStudents.isEmpty()}" class="alert alert-success">
        <i class="fas fa-check-circle"></i> M·ªçi sinh vi√™n ƒë·ªÅu ƒë√£ ƒë∆∞·ª£c x·∫øp v√†o l·ªõp.
    </div>

    <div th:unless="${groupedStudents.isEmpty()}">
        <ul class="nav nav-tabs" id="majorTabs" role="tablist">
            <li class="nav-item" th:each="major, iterStat : ${majors}">
                <button th:id="${'tab-' + major.replace(' ', '_')}"
                        th:class="'nav-link' + (${iterStat.first} ? ' active' : '')"
                        data-bs-toggle="tab"
                        th:data-bs-target="${'#content-' + major.replace(' ', '_')}"
                        type="button" role="tab"
                        th:aria-controls="${'content-' + major.replace(' ', '_')}"
                        th:aria-selected="${iterStat.first}"
                        th:text="|${major} (${groupedStudents.get(major).size()} SV)|">
                    Chuy√™n ng√†nh
                </button>
            </li>
        </ul>

        <div class="tab-content border border-top-0 p-3" id="majorTabContent">
            <div th:each="entry, iterStat : ${groupedStudents}"
                 th:id="${'content-' + entry.key.replace(' ', '_')}"
                 th:class="'tab-pane fade' + (${iterStat.first} ? ' show active' : '')"
                 role="tabpanel"
                 th:aria-labelledby="${'tab-' + entry.key.replace(' ', '_')}">

                <h5 class="text-info mb-3">Chuy√™n ng√†nh: <span th:text="${entry.key}"></span> (<span th:text="${entry.value.size()}"></span> sinh vi√™n)</h5>

                <table class="table table-sm table-hover table-striped">
                    <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>T√™n Sinh vi√™n</th>
                        <th>Email</th>
                        <th>SƒêT</th>
                        <th class="text-center">H√†nh ƒë·ªông</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="student : ${entry.value}">
                        <td th:text="${student.id}"></td>
                        <td>
                            <a th:href="@{/students/detail/{id}(id=${student.id})}" target="_blank" th:text="${student.studentName}">T√™n SV</a>
                        </td>
                        <td th:text="${student.email}"></td>
                        <td th:text="${student.sdt}"></td>
                        <td class="text-center d-flex justify-content-center gap-2">
                            <form th:action="@{/students/assign-class/{id}(id=${student.id})}" method="post" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-outline-success"
                                        onclick="return confirm('X√°c nh·∫≠n x·∫øp l·ªõp t·ª± ƒë·ªông cho sinh vi√™n n√†y?');"
                                        title="T√¨m l·ªõp ph√π h·ª£p c√≤n ch·ªâ ti√™u v√† x·∫øp l·ªõp ngay">
                                    <i class="fas fa-magic"></i> T·ª± ƒë·ªông
                                </button>
                            </form>
                            <a th:href="@{/students/edit/{id}(id=${student.id})}" class="btn btn-sm btn-outline-secondary" title="Ch·ªânh s·ª≠a th√¥ng tin sinh vi√™n v√† ch·ªçn l·ªõp th·ªß c√¥ng">
                                <i class="fas fa-edit"></i> Th·ªß c√¥ng
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>